<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sp_seeker</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>PAR_BREAKABLE</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Initialize Seeker

// STATS
acc = .2; // acceleration
chase_speed = random_range(3.8, 4.2);
idle_speed = 3;
//maxspd = random_range(4.5, 5); // range of values maxspd can be
maxspd = chase_speed;
xaxis = 0;
yaxis = 0;
initialize_movement_entity(  0,       // gravity
                            .1,       // friction
                            0,        // air resistance
                            0,     // bounciness
                            PAR_SOLID);   // collision object

event_inherited();
attack = 10;
hp = 500;

mobile = 1;
text = 1;
//crit = 1;
            
// States 
state = state_npc_chase;
//state = state_npc_chase;
alarm[2] = room_speed * irandom_range(2, 5);

// Target variables                
seen = false; // (boolean) has line of sight?
los = false;
tx = x; // x value of target
ty = y; // y value of target
lastx = x; // x value where target was last seen
lasty = y; // y value where target was last seen
target = ob_player;

// Pathfinding
search = 0;
path = path_add(); // Create path
set = 0; // Whether or not path is being used
tick = 30; // How frequently new paths are generated
alarm[1] = tick; // Set path reset alarm

image_speed = 1 / room_speed;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Wander
search = 1;
if (/*alarm[2] &lt;= 0 &amp;&amp;*/ search == 0) {
    state = choose(state_npc_wander, state_npc_idle)
    ty = random(room_height);
    tx = random(room_width);
    search = 1;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Path Reset Alarm
//if (!los) {
//if (!seen) {
if (seen) {
    var mx = (tx div 32) * 32 + 16;
    var my = (ty div 32) * 32 + 16;
    
    if (mp_grid_path(global.grid, path, x, y, mx, my, true)) {
        path_set_kind(path, 1);
        path_set_precision(path, 4);
        path_set_closed(path, false);
        set = 1;
        ind = 0;
    }
}

alarm[1] = tick;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Stall

// Momentarilly stops seeker after dealing damage to a target
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Death Check
if (hp &lt;= 0) {
    path_delete(path);
    //hp = 700;
    instance_destroy();
}

script_execute(state);

// Get Target
//if instance_exists(target)
    //get_target(target, view_wview);

/*// Direction Checking and PathFinding
var up, down;
var yaxis = 0;

//if (alarm[0] &lt;= 0) {
    if (los) {
        //if (seen)
            //maxspd = chase_speed;
            
        // Move in the direction of the target
        if (tx &gt; x) {
            xaxis = 1;
        }
        if (tx &lt; x) {
            xaxis = -1;
        }
        if (ty &gt; y+16) {
            yaxis = 1;
        }
        if (ty &lt; y+16) {
            yaxis = -1;
        }
        //get_npc_axis(xaxis, tx, ty);
    } else {
        //maxspd = idle_speed;
        if (set == 1) {
            dist = path_get_length(path);    
            xaxis = sign(path_get_x(path, ind+maxspd/dist) - x);
            yaxis = sign(path_get_y(path, ind+maxspd/dist) - y);
            ind += maxspd / dist;
        }
    }
    if (yaxis == 1) {
        down = 0;
        up = 1;
    } else {
        down = 1;
        up = 0;
    }
    
    // Check if on ground
    ground = place_meeting(x, y+1, collision_object);
    
    // Enable horizontal and vertical movement
    enable_movement_run(acc, maxspd, maxspd, xaxis);
    enable_movement_rise(acc, maxspd, maxspd, up, down);
    
    // Move
    move_movement_entity();
    
    // Attack target
    if place_meeting(x, y, target) {
        var i = instance_create(other.x, other.y, PAR_DAMAGE);
            i.damage = attack;
            i.creator = id;
            
        //alarm[0] = 25;
        hsp[0] = sign(x-target.x) * 6;
        vsp[0] = sign(y-target.y) * 6;
    }
//}/**/

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Draw self
draw_self();

// Draw Debug stuff
if (global.debug = 1) {
    draw_set_font(fn_01);
    draw_set_halign(fa_left);
    draw_text(lastx+16, lasty, "lastx (" + string(lastx)+","+string(lasty)+")"); // lastx and lasty
    draw_text(x+sprite_width/2, y+20, "seen "+string(seen)); // LOS?
    draw_text(x+sprite_width/2, y+10, object_get_name(target)); // target name
    
    draw_set_color(c_blue);
    if (!los &amp;&amp; set)
        draw_path(path, x, y, true);
    else
        draw_line(x, y, tx, ty) // line to target
        
    draw_set_color(c_orange);
    draw_circle(tx, ty, 4, false);
    
    // Draw Critical Zone
    //script_execute(crit_location, 0, 0, self, 1);
    event_inherited();
};
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
